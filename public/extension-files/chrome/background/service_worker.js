(()=>{"use strict";var e={},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}o.rv=()=>"1.4.11",o.ruid="bundler=rspack@1.4.11";let r="tum_listem_guest_uuid",a="tum_listem_permanent_uuid",s="tum_listem_login_status";async function n(e){try{return await chrome.storage.local.set({[r]:e}),!0}catch(e){return!1}}async function u(e){try{return await chrome.storage.local.set({[a]:e}),await chrome.storage.sync.set({[a]:e}),await chrome.storage.local.set({[s]:!0}),await chrome.storage.sync.set({[s]:!0}),!0}catch(e){return!1}}async function c(){try{let e=await chrome.storage.local.get([a]),t=e[a];if(!t&&(t=(e=await chrome.storage.sync.get([a]))[a])&&(await chrome.storage.local.set({[a]:t}),console.log("\uD83D\uDD04 [Background] Permanent UUID sync storage'dan restore edildi:",t)),t)return{uuid:t,type:"permanent"};return{uuid:(await chrome.storage.local.get([r]))[r],type:"guest"}}catch(e){return{uuid:null,type:"none"}}}async function i(){try{let e=await c();if(e.uuid&&"none"!==e.type)if("guest"===e.type)return console.log("\uD83D\uDC64 [Background] Mevcut Guest UUID kullanılıyor:",e.uuid),e.uuid;else return console.log("\uD83D\uDC64 [Background] Permanent UUID mevcut, Guest UUID gerekmez:",e.uuid),e.uuid;{let e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});return await n(e),e}}catch(e){return null}}chrome.runtime.onMessage.addListener((e,t,o)=>{if("getActiveUUID"===e.action)return c().then(e=>{o(e)}),!0;if("setGuestUUID"===e.action)return n(e.uuid).then(e=>{o({success:e})}),!0;if("setPermanentUUID"===e.action)return u(e.uuid).then(e=>{chrome.storage.local.set({[s]:!0}),chrome.storage.sync.set({[s]:!0}),o({success:e})}),!0;if("apiRequest"===e.action){let{method:t,endpoint:r,data:a}=e;return console.log(`\u{1F310} [Background] API iste\u{11F}i g\xf6nderiliyor: ${t} /api/${r}`,a),fetch(`https://my-heybe.vercel.app/api/${r}`,{method:t||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},body:a?JSON.stringify(a):void 0}).then(e=>{if(console.log(`\u{1F4E1} [Background] API response status:`,e.status,e.statusText),!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()}).then(e=>{o({success:!0,data:e})}).catch(e=>{o({success:!1,error:e.message})}),!0}return"ensureGuestUUID"===e.action?(i().then(e=>{o({uuid:e})}),!0):"clearGuestUUID"===e.action?(chrome.storage.local.remove([r]).then(()=>{o({success:!0})}),!0):"logout"===e.action?(Promise.all([chrome.storage.local.remove([r]),chrome.storage.local.set({[s]:!1}),chrome.storage.sync.set({[s]:!1})]).then(()=>{o({success:!0})}),!0):"getUserId"===e.action?(c().then(e=>{o({userId:e.uuid})}),!0):"setUserId"===e.action?(n(e.userId).then(e=>{o({success:e})}),!0):void 0}),chrome.runtime.onInstalled.addListener(async()=>{console.log("\uD83D\uDE80 [Background] Extension y\xfcklendi, Guest UUID kontrol ediliyor..."),await i()}),chrome.storage.onChanged.addListener((e,t)=>{if("local"===t){if(e[r]){let t=e[r].newValue;console.log("\uD83D\uDD04 [Background] Guest UUID değişti:",{old:e[r].oldValue,new:t}),chrome.tabs.query({},e=>{e.forEach(e=>{try{chrome.tabs.sendMessage(e.id,{action:"guestUUIDChanged",uuid:t})}catch(e){}})})}if(e[a]){let t=e[a].newValue;console.log("\uD83D\uDD04 [Background] Permanent UUID değişti:",{old:e[a].oldValue,new:t}),chrome.tabs.query({},e=>{e.forEach(e=>{try{chrome.tabs.sendMessage(e.id,{action:"permanentUUIDChanged",uuid:t})}catch(e){}})})}if(e[s]){let t=e[s].newValue;console.log("\uD83D\uDD04 [Background] Login status değişti:",{old:e[s].oldValue,new:t}),chrome.tabs.query({},e=>{e.forEach(e=>{try{chrome.tabs.sendMessage(e.id,{action:"loginStatusChanged",isLoggedIn:t})}catch(e){}})})}}})})();