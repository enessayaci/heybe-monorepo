Heybe prompt

Bu bir monorepo, daha önce demosunu geliştirdim bir repodur. İçinde eski kodlar mevcut. Senden bazen eski kodlara bakıp oralardaki yapıyı refactor ile güncellemeni isteyebilirim. Yeni kuracağın yapıda yine monorepo olmalı.Frontend(website), backend ve eklentiyi ben şimdilik lokalimden test edeceğim. Yani local portta çalışan backend, locak portta çalışan website, ve local klasörden yol göstererek yüklediğim eklentiyi kendi bilgisayarımda test edeceğim. Ancak backendin veri tabanı bağlantı stringini gerçek bir ortamdan BEN oluşturup sana vereceğim.Proje backendini yazarken, ihtiyacın olan veritabanı tablo şemaları için SQL scriptini oluşturup bana ver, bende veritabanında SQL komutlarını çalıştırıp senin için hazır hale getireyim.Proje için paket yöneticisi olarak pnpm kullan!1- Senden 3 adet klasör altında 3 tane uygulama istiyorum. Klasörlerin isimleri heybe-api, heybe-website, heybe-extension
2- Bu 3 uygulama aynı projeye ait frontend, backend ve browser eklenti uygulamaları olacak a.Öncelikli olarak backend için heybe-api klasörü altında, eski heybe-website-old_0 altındaki api klasöründeki, serverless functionları, ana dizin altında heybe-api klasörü içinde yepyeni bir node.js uygulamasına çevirmeni istiyorum. Eğer ek bir backend fonksiyonu, enpointi, işlevi eklemen gerekirse önce bana sor! Çünkü eski çalışan serverless functionlar bu uygulama için yeterli olmalı. b. Yeni yazacağın website frotnedindede istekler için yeni backend uygulamasını kullanacaksın. c. Backend için veri tabanı bağlantısı connection stringi sana ben vereceğim. Gerçek bir veri tabanı bağlantısı sağlayacağız. d. İhtiyacın olan veritabanı tablo şemaları için SQL scriptini oluşturup bana ver, bende veritabanında SQL komutlarını çalıştırıp senin için hazır hale getireyim.3- projenin amacı, farklı alışveriş sitelerini gezerken, tarayıcıya yüklediğim bir eklenti sayesinde ekranda bir buton göreceğim. Bu butona basınca tüm siteleri gezerken derlediğim ürünleri tek bir listeye eklemiş olacağım.4- Şimdi sana genel olarak akışda istediğim özellikleri anlatıyorum:
a. Kullanıcı, listesini bir websitesi, frontend uygulaması yoluyla görecek
b. Kullanıcı, eklentiyi yüklediğinde otomatik bir misafir kullanıcı uuid atanacak, ve bu sayede üye olmadan kendi özel listesini oluşturabilecek.
c. Kullanıcı, misafir olarak eklenti sayesinde eklediği ürünleri, PostgreSQL kullanılarak hazırlanmış bir veritabanına kaydedecek. d. Kullanıcı, dilerse listesinde ürünler varken kayıt oluşturabilecek, ve bu durumda misafir olarak eklediği ürünler veritabanında da yeni oluşturduğu kullanıcı hesabına transfer olacak.
e. Kullanıcı, misafir olarak işlem yaparken var olan bir hesabına giriş yaparsa da aynı şekilde giriş yapılan hesaba, o anki misafir kullanıcı ile eklenmiş ürünler transfer olacak.
f. Transfer işlemini backend arka plan halledecek. g. Eklentinin Storage alanını merkez Storage alanı olarak kullanacaksın. Örneğin, websitesine giren kullanıcı, arka planda önce eklentiyi arayacak ve onun storageına erişip oradan setlenmiş olan kullanıcı uuidını okumaya çalışacak. Oradan okumuş olduğu uuid ile işlem yapacak.Front end tarafı detayları: 1- Frontend uygulaması React, shadcn ve eğer cıs gerekliyse tailwind kullanılarak hazırlanacak. 2- Frontend, ikon paketi olarak öncelikle varsa shadcn in sağladığı ikon paketini kullanacak. Yoksa tailwindin sağladığı ikon paketini kullanacak. 3- Fronted uygulamasının tasararımı tek sayfa şeklinde olacak. Solda açılıp kapanabilen bir sidebar olacak. Sidebar kapandığında saya içeriğine kalan alanda genişleyip/daralacak. 4- Sidebar menüleri ikonlu olacak, Sidebar kapandığında sadece ikonları görünecek. Ve Sidecar kaplıyken görünen menü ikonlarının üzerine mouse hover yapınca menü ismi tooltip ile görünmeli. 5- Sidebarda 3 tane menü olacak. Birinci: Ürünlerim İkinci: Kurulum
6- Sidebarın en üstüne, açık halince uygulamanın ismi olan “Heybe” yazacak. Ve solunda bir uygulama logosu olacak. 7- Sidebarın en altına yapışık bir şekile şu alanlar olacak:
a. Giriş yapan kullanıcının e mail bilgisi (Eğer misafir ise misafir yazar) b. Giriş yap/ Kayıt Ol menüsü. Tıklayınca bir kopup açılır (shadcn) ve içinde yine bir shadcn tabı olur. Giriş ve Kayıt Tab sekmeleri. c. Dil seçim alanı. İngilizce ve Türkçe destekli bir shadcn dropdownı olacak. Seçenekler dillerin 2 li kodu ve solunda ülke bayrağı şeklinde olacak. Örnek: Türk Bayrağı + TR, İngiliz bayrağı + EN. Seçilen dil seçeneği, sidebar kapalı olduğunda sadece ülke bayrağı olarak görünecek ve üzerine gelince tooltip ile seçilen dilin 2 li kodu yazacak. Sidebar kapalıykende dil seçim dropdownı açılabilir olacak. d. Eğer kullanıcı giriş yaptıysa, Giriş yap / Kayıt ol butonu yerine Çıkış Yap butonu yer alacak. 8- Sayfa içeriğinde Ürünlerim kısmında tek satırlar halinde alt alta ürünler listelenecek. Bu ürünler kullanıcının backend abisi yoluyla veritabanına eklediği ürünler olacak. Yani bir get isteğiyle ilgili uuid ile çekilecek.
9- Ürün satırları şöyle olacak: en solda resim, hemen sağında ürün başlığı, başlığın altında daha hafif bir font ve renkte ürünün kaynak domaini, en sağda 2 adet ikon buton. Birisi yönlendirme butonu, ürünün url ine yönlendirecek; diğeri silme butonu, ürünü veritabanından ilgili kullanıcı uuidi ile bulup silecek. 10-Ürünler listesinin üstünde bir bar olacak, bu barın solunda ürün arama inputu olacak. Bu input ürünlerde client side arama yapacak. Ürün adı, site domain ismi ile arama yapabilir. En sağda ise 2 adet bilgi yer alacak: toplam ürün ve toplam kaç farklı site bilgisi. Bu bar, eğer ürünler listesi boş ise görünmeyecek. 11- Ürünler boş ise bir boş içerik uyarısı göstereceksin. 12- Sidebardaki Kurulum menüsüne tıklayınca ekranda bir kopup açılacak. Popup içinde eklentinin yüklenmesi gerektiğine dair mesaj ile birlikte, ilgili tarayıcının eklenti sayfasına bizim eklentiye yönlendiren bir buton yer alacak.
13- Kullanıcı Sidebardaki çıkış yap butonuna basınca, eklentinin storageında setlenmiş olan güncel kullanıcı uuidı sıfırlanacak ve bir misafir uuidi ile değişecek. Websitesinin lokalinde tutulan aynı key ismindeki aktif kullanıcı da yine eklentideki alanın değişmesiyle güncel uuid bilgisini eğer websitesi açıksa hemen alıp aktif kullanıcı bilgisini ve o kullanıcı ait ürünler listesini güncelleyecek. 14- Eğer eklenti zaten yüklü ise, kurulum popupındaki butonun yerine, eklentinin zaten yüklü olduğuna dair bir mesaj yazacak. 15- Sayfa açıldığında, eğer eklenti kurulu değilse, sayfanın en üstünde kapatılabilir bir uyarı çıkacak. Bu uyarıda eklentinin kurulu olmadığı, ürün eklemek için kurulması gerektiği bilgisi yazacak. Uyarı mesajının yanında ise bir buton yer alıp, o butona tıklayınca yine kurulum popupı açılacak. 16- Websitesi, eklenti kurulu değilse bile kullanıcının sadece var olan ürünlerini görme isteğine cevap vermek için giriş yapılabilir ya da kayıt olunabilir olacak. Giriş/kayıt sonrası response dan gelecek olan uuid, website local storageına kaydedilecek. Bu sayede kullanıcı, eklentiyi kurmamış olsa bile sayfayı yenilediğinde en son giriş yaptığı kullanıcıyla ürünleri görebilecek. 17- Eklenti kurulduğunda ise otomatik yeniden atanan misafir uuidinden eğer o an websitesi açıksa annda haberdar olup , hemen aktif kullanıcı bilgilerini güncellemeli ve ürünleri yeni kullanıcı uuidi ile sıfırlamalı. 18- Misafir olarak eklenti yoluyla eklemiş bazı ürünler varsa, kullanıcı websitesinden giriş yaptığı anda o anki msaifr kullanıcının uuidi ni de gönderip, backendin o misafir uuidına ait ürünleri, yeni giriş yapılan ya da kayıt olunan kullanıcıya aktarmasını sağlayacak.Eklenti tarafını detayları: 1- Eklenti, şu tarayıcılarda çalışmalı: safari, Chrome, firefox, Edge, Brave. 2 Eklenti, wxt isimli paketi kullanarak, react ve shadcn bileşenleri ile hazırlanmalı. Eklentide react templates var. Gerekirse tailwind ile sitllendirilmeli. Wxt ile desteklenmeyen bir tarayıcı var ise orada nasıl bir yol izleyeceğini bana anlat. Desteklemek istedim tarayıcılar şunlar: chrome, Brave, edge, firefox, safari a. Eklentinin GitHub linki: https://github.com/wxt-dev/wxt b. https://wxt.dev/ bu da eklentinin websitesi 3- Eklenti kurulduğunda otomatik olarak eklenti Storage alanına bir misafir uuid setlenmeli. Bu eklenti storageı projenin merkezi storageı gibi davrancak, yani websitesinin eğer o an açıksa buradaki güncel kullanıcı uuidi değişim bilgisinden haberi olmalı. Ve web sitesi ilk açılışta yine eklentinin Storage alanından güncel kullanıcı uuid bilgisini alacak. 4- Eklenti, alış veriş sitelerinin ürün detay sayfalarında çalışmak için planlandı. 5- Bir sayfanın ürün sayfası olduğunu anlamak için basit bir yönlemle sayfada İngilizce ve türkçe olarak şu ifadeleri araştırabilirsin: Sepete Ekle, ekle, ada to basket, add. Genelde bir bir ürün sayfasında bu ifadeleri içeren bir buton ya da div ya da span ya da a elementi oluyor. Ama bazı sitelerde ürün detay sayfası olmasa da bu ifadelere yer veren bileşenler olabiliyor. Bu nedenle bir sayfanın ürün sayfası olup olmadığını anlamak için biraz daha detaylı bir algoritma kullanabilsin. a. Algoritma detayları tavsiyeleri: DOM içeriğinden basit kontrole ilave olarak, sayfanın meta tag lerinde genel geçer bir ürün sayfasının meta taglerini araştırabilirsin. Eğer genel geçer ürün meta tagleri var ise genelde bir ürün sayfasıddır. Bir diğer tavsiyem ise şu: genelde ürün detay sayfalarında ürünün toplu resimlerini içeren bir img ler listesi olabiliyor. Ya da img ler içeren liste benzeri yapılar oluyor. 6- Ürün ekleme butonunun stili: a. Sayfa yüklendiğinde şayet 5. Maddedeki algoritma bu sayfanın bir ürün sayfası olduğuna karar verirse, sayfanın sağ orta kısmında bir buton yerleşecek. Position fixed olacak ve yapısı şöyle olacak: 2 ye bölünmüş pil bir buton ve solda Uygulama Logosu + “Heybeye Ekle” , sağda ise liste ikonu + “Ürünleri gör”. İkiye bölünmüş bu buton hafif bir shadowa sahip olacak. Soldaki heybeye ekle butonun arka planı beyaz olacak. Sağdaki ürünleri gör butonunun arka planı ise projeye senin belirleyeceğin ana renk olacak. b. 2 ye bölünmüş, wrap olmayan yan yana uzun olan bu buton, sayfada sağda ortada sadece soldaki ikonun logo su görünecek kadar sağa girecek. Mouse ile üzerine hover olunca sola doğru açılacak. c. Heybeye ekle butonuna basıp, istek gitmeye başladığında buton loading duruma girecek ve o an tıklanmayacak. d. İstek bitip response başarılı döndüğünde, buton 2 saniyelik bir progress sürecine girecek. Bu 2 saniye boyunca Soldaki buton Yeşil Tik İkonu + yeşil renkte ”Ürün Eklendi” olacak. Bu 2 saniye boyunca soldaki butonun altında 3 px yüksekliğinde soldan sağa doğru position aboslute yerleşmiş bir progress bar, yeşil renkte dolacak. 2 saniyelik progress süreci bittiğinde ise soldaki buton tekrar orijinal haline yani Logo + “Heybeye Ekle” yazılı haline dönecek. 7- Ürün ekleme butonu işlevi: a. 6. Maddede bahsettiğim soldaki butona basınca, sayfadan meta tagleri ile toplanan ürünün bilgileri atılacak bir ürün ekleme isteği ile veri tabanına kaydedilecek. Dönen response un sonucuna göre sağ üstte bir toast görünmeli. b. “heybeye ekle” butonuna basıldığında önce eklenti storageındaki aktif kullanıcı uuidı alınacak. Eklenti kurulduğunda otomatik atandığı için burada bir uuid olmama ihtimali yok, ama bu aşamada yoksa ya da erişilemese bir sorun vardır ve bu durumda sağ üstte bir tost gösterilir. c. “heybeye ekle” butonuna basıldığında önce eklenti storageındaki aktif kullanıcının misafir olup olmadığı bilgiini tuttuğu bir alanı okuyacak. Eğer misafir ise, bir popup açılacak. Bu popupda aynı websitedeki Giriş yap/ Kayıt ol formun görümünde bir form açılmalı. Aynı websitedeki popup gibi 2 sekmeli olmalı. Buna ilave birde ppupın en altına “Misafir oalrak devam et” butonu olmalı. Kullanıcı eğer Msaifr olarak devam eders, o anda Storage daki aktif kullanıcı uuid ne ise onunla ürün ekleme isteği gider. Eğer kullanıcı giriş ya da kayıt yaparsa, dönecek olan response beklenir, response dan dönen uuid ile eklenti Storage ı güncellenir, haliyle eğer website açıksa orayada haber gider ve websitede kendi locacilni yeni uuid değeriyle günceller ve artık misafir olmadığımız için ilgli alanı da günceller, ardından o an eklenmekte olan ürün, response dan gelecek uuid ile ekleme isteği gönderir, ve son olarak ürün ekleme isteği giderken güncel uuidın yanı sıra bir de misafir uuidı gönderilir. Bu, giriş yapmadan önce son kullanılan msaifr tükendir ve backend, bu misafire ait olan tüm ürünleri alır, giriş ya da kayıt yapan yeni kullanıcıya transferini yapar. Böylece misafir olarak işlemlerine başlamış bir kullanıcı, giriş/kayıt yaparsa ürünlerini kaybetmez. d. Bir önceki c maddesindeki gibi giriş/kayıt değilde, heybeye ekle dedikten sonra eğer o an misafirse aıçılacak olan popuptaki ”misafir olarak devam et” butonuna basarsan o anki güncel kullanıcı uuidsi ile ürün ekleme isteği gönderilir. Backend bu uuid ile ürün ekleme işlemini gerçekleştirir. e. Eğer giriş ya da kayıt yapılıysa, eklenti storageındaki setlenmiş bir alan yoluyla bu kayıt altında olduğu için, kullanıcı “heybeye ekle” butonuna basınca popup görmeden doğrudan ürün ekleme isteğini o anki güncel uuid ile gönderir.DİKKAT: Eklenti Storage ında tutacağın keylerin ismi “token” ve is_guest olsun. Uuid, backend tarafından giriş/kayıt sırasında kullanıcıya otomatik oluşturulsun. Website lokalini, yeni girişlerde eklenti storageına ulaşabilirsen oradaki token ve auto alanlarıyla, aynı isimlerde local Storageında güncellemeyi unutma. Websitesinde çıkış yapınca da hem eklenti hem de website local storageını sıfırlamayı ve yine eklenti ile website storageındaki değerleri güncel tutmayı unutma! Uygulamanın sorunsuz çalıştığını teyit amaçlı olarak aşağıdaki 16 maddelik adımı safari, chromei bravei edge ve firefox tarayıcılarında test edeceğim:Heybe test maddeleri
1- Websitesisi açılır, eklenti henüz yüklenmemiştir. Kullanıcı Kayıt oluşturur. Kayıt oluşturulduktan sonra response dan dönen uuid , website local storage ında saklanır. saklanan keyin adı "token" dir.
2- Sonra eklenti yüklenir. Eklenti yüklendiğinde otomatik bir misafir uuid oluşturur. Bunu da eklenti storage ında "token" olarak kaydeder. Ve eklenti storage ında ayrıca "is_guest" alanı saklanır, ve bu alan true olarak setlenir.
3- Websitesi, eklenti yüklüyken sayfa yenilenir. Websitesi önce eklenti storage ını kontrol eder. Eğer orda bir token var ise, onu alır ve kendi local storage ındaki token ye setler. Yani kendini eklenti storagı ile güncel kalır. Aynı şekilde is_guest alanını da eklenti storage ından alır ve kendi local storage ında günceller.Sidebardaki aktif kullanıcı kısmına da is_guest true olduğu için Misafir olarak belirtir.
4- Kullanıcı, eklenti ile her hangi bir alış veriş sitesinde Heybeye Ekle butonuna basar, eklenti storage ındaki is_guest alanını kontrol eder ve GUEST ise Popup açar, kullanıcı bu popup ile giriş yap, ya da misafir olarak devam et diyebilir. Misafir olarak devam et derse, o an eklenti storage ındaki token ile ürünü ekleme isteği atar. Eğer O aşamada Giriş yaparsa, giriş iseği atılır ve response dönene kadar beklenir. Response başarısız ise backendden gelen hata forma yazılır. Response başarılı ise dönen uuid , eklenti storage ındaki token kısmına setlenip, auto alanı da VERIFIED olarak güncellenir. Ve arkasından yeni uuid ile ürün ekleme iseği atılır. Aynı giriş operasyonunda olduğu gibi kayıt operasyon da response da yeni uuid döner ve aynı operasyonlar ondada tekrarlanır.
5- Artık is_guest=VERIFIED olduğu için bundan sonra alışveriş sitelerindeki Heybeye Ekle butonuna basınca Doğrudan güncel token ile ürün ekleme iseği atılır. 6. Eğer aynı anda yan yana 3-5 tane ürün detay sayfası açılmış ise, giriş ya da kayıt işleminin ardından eklenti storage token alanı yenilendiği için, geri kalan ürün sayfalarındaki sayfayı yenilemeye gerek kalmadan otomatik eklenti storageındaki token yi okuyup ürün ekleme isteği onunla atılmalı.
7- Kullanıcı en baştaki sekmede açık bekleyen heybe websitesine geri döner, ordan çıkış yap butonuna basar. Çıkış yaptıktan sonra hem local storage ındaki hem de eklenti storageındaki token ve is_guest alanlarını resetler. Hemen eklenti yüklü mü kontrolü yapar, ve eğer eklenti yüklü ise otomatik misafir uuid oluşturur. Hem eklenti hemde local storage larında token yi günceller ve ikisindede is_guest alanını true yapar.
8- artık açık olan ürün sekmelerinde Heybeye Ekle butonuna basınca , is_guest true olacağı için yine Popup açılır. Kullanıcı Misafir oalrak devam et e basar ve ürünler misafir uuid ile eklenir.
9- Kullanıcı websitesine geri döner, ve giriş yapar, giriş yaparken, website local storage ındaki token ye ait ürünleride, yeni giriş yaptığı uuid li user a transfer eder. Burda amaç, kullanıının misafir olarak heybesine eklediği ürünleri, giriş yaptığında kaybetmeden hesabında ekli görmesi.
10- 9. maddedi giriş işleminin operasyonları, aynen kayıt içinde gereklidir.
11- 9 ve 10. maddelerdeki işlemler, eklentiyi misafir olarak kullanırken Heybeye ekle butonuna basarsak açılan popuptada geçerlidir çünkü ordada giriş ve kayıt butonları vardır.
12- Kullanıcı gidip eklentiyi kaldırır.
13- heybe websitesine döner, eklenti olmadığı için sayfayı yenilediğinde eklenti storage ını bulamayacak. Bu durumda eklenti storage ı bulunamadığı için local storage daki setli keylerde işlem yapmaya devam edebilir. Bu durumda mesela en son giriş yaptığı kullanıcnın değerleri localinde olacağı için o kullanıcının değerleriyle ürünlerini görmeye ve silme işlemleri yapmaya devam edebilir. Ancak eklenti yüklü olduğunda eklenti storage ı alınacağı için ordaki setlenmiş değerlerde local Storage ınıa güncellemeli. Yani eklenti storage ı okunabiliyorsa, localdek değerleri kesinlikle eklenti storage ı ile güncelleyecek, ama eklenti Storage bulunamaz ise o zaman localindeki değerlerde işlem yapabilir.

14- Sidebardaki log out butonu, websitesinden hem local storage a setlenmiş keyleri silmeli, hem de eklenti storage ındaki keyleri silmeli.
Arkasından da eğer eklenti storageına erişim var ise, yani eklenti yüklü olduğu anlamına gelir, hem kendi local storagında hemde eklenti storageında token ye yeni misafir uuid setlemeli, ve is_guest=true yapmalı.

15- Eğer eklenti yüklü değilken log out yaparsa haliyle eklenti storage ı bulamayacak, bu durumda sadece localini silmesi yeterli olacak. Arkasından misafir uuid oluşturmasın, çünkü eklenti yüklü değil!

16- Websitesinin log out durumunda otomatik misafir id oluşurma işlemi, eğer eklenti storage ın aerişim olursa olmalı e api den oluşturma endpointi ile yapılmalı, yani token api den alınmalı, eklenti storagınada zaten eklenti yüklü deilse erişilemiyordu.—————Yukarda yazdıklarım doğrultusunda /docs klasörüne markdown formatında bir roadmap oluştur. Markdownın en üstüne ana başlıkları kapsayan birde progress tablosu ekle.
